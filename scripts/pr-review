#!/usr/bin/env bash
set -euo pipefail

script_dir="$(cd "$(dirname "$0")" && pwd)"
base="$script_dir/pr"
if common_git_dir=$(git -C "$script_dir" rev-parse --path-format=absolute --git-common-dir 2>/dev/null); then
  canonical_base="$(dirname "$common_git_dir")/scripts/pr"
  if [ -x "$canonical_base" ]; then
    base="$canonical_base"
  fi
fi

if [ "${1:-}" = "-h" ] || [ "${1:-}" = "--help" ] || [ "$#" -lt 1 ]; then
  cat <<'USAGE'
Usage:
  scripts/pr-review <PR_NUMBER_OR_URL>
USAGE
  exit $([ "$#" -lt 1 ] && echo 1 || echo 0)
fi

exec "$base" review-init "$@"
